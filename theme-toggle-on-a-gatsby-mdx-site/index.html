<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.42eccdd5daff972cb493.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,300;0,400;0,500;1,300;1,500&display=swap);
/*! tailwindcss v2.2.19 | MIT License | https://tailwindcss.com *//*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-text-size-adjust:100%;line-height:1.15;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:0}hr{color:inherit;height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted ButtonText}:-moz-ui-invalid{box-shadow:none}legend{padding:0}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid;box-sizing:border-box}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#9ca3af;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#9ca3af;opacity:1}input::placeholder,textarea::placeholder{color:#9ca3af;opacity:1}[role=button],button{cursor:pointer}:-moz-focusring{outline:auto}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{color:inherit;line-height:inherit;padding:0}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-border-opacity:1;--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);--tw-filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);border-color:rgba(229,231,235,var(--tw-border-opacity))}.sr-only{clip:rect(0,0,0,0);border-width:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.left-1\/2{left:50%}.m-0{margin:0}.my-0{margin-bottom:0;margin-top:0}.mx-auto{margin-left:auto;margin-right:auto}.mt-2{margin-top:.5rem}.ml-4{margin-left:1rem}.mb-12{margin-bottom:3rem}.mb-4{margin-bottom:1rem}.ml-8{margin-left:2rem}.mb-8{margin-bottom:2rem}.flex{display:flex}.inline-flex{display:inline-flex}.h-full{height:100%}.h-5{height:1.25rem}.w-full{width:100%}.w-8{width:2rem}.max-w-2xl{max-width:42rem}.flex-shrink-0{flex-shrink:0}.-translate-x-1\/2{--tw-translate-x:-50%;transform:var(--tw-transform)}.list-inside{list-style-position:inside}.list-disc{list-style-type:disc}.list-decimal{list-style-type:decimal}.appearance-none{-webkit-appearance:none;-moz-appearance:none;appearance:none}.flex-row-reverse{flex-direction:row-reverse}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(1.5rem*var(--tw-space-y-reverse));margin-top:calc(1.5rem*(1 - var(--tw-space-y-reverse)))}.space-y-12>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(3rem*var(--tw-space-y-reverse));margin-top:calc(3rem*(1 - var(--tw-space-y-reverse)))}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)));margin-right:calc(.5rem*var(--tw-space-x-reverse))}.space-y-16>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(4rem*var(--tw-space-y-reverse));margin-top:calc(4rem*(1 - var(--tw-space-y-reverse)))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-bottom:calc(2rem*var(--tw-space-y-reverse));margin-top:calc(2rem*(1 - var(--tw-space-y-reverse)))}.overflow-auto{overflow:auto}.rounded-sm{border-radius:.125rem}.rounded-lg{border-radius:.5rem}.rounded-full{border-radius:9999px}.border{border-width:1px}.border-l-4{border-left-width:4px}.border-b{border-bottom-width:1px}.border-dashed{border-style:dashed}.border-red-600{--tw-border-opacity:1;border-color:rgba(220,38,38,var(--tw-border-opacity))}.border-blue-400{--tw-border-opacity:1;border-color:rgba(96,165,250,var(--tw-border-opacity))}.border-yellow-400{--tw-border-opacity:1;border-color:rgba(251,191,36,var(--tw-border-opacity))}.border-current{border-color:currentColor}.bg-gray-200{--tw-bg-opacity:1;background-color:rgba(229,231,235,var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgba(17,24,39,var(--tw-bg-opacity))}.bg-opacity-20{--tw-bg-opacity:0.2}.p-2{padding:.5rem}.p-1{padding:.25rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.pl-4{padding-left:1rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-xl{font-size:1.25rem}.text-lg,.text-xl{line-height:1.75rem}.text-lg{font-size:1.125rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.font-bold{font-weight:700}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.tracking-wide{letter-spacing:.025em}.text-black{--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity))}.text-red-600{--tw-text-opacity:1;color:rgba(220,38,38,var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity:1;color:rgba(17,24,39,var(--tw-text-opacity))}.no-underline{text-decoration:none}.filter{filter:var(--tw-filter)}.transition-colors{transition-duration:.15s;transition-property:background-color,border-color,color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-300{transition-duration:.3s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}:root{font-family:Source Code Pro,monospace}.twitter-tweet{margin:0 auto}.after\:h-4:after{content:"";height:1rem}.after\:w-4:after{content:"";width:1rem}.after\:rounded-full:after{border-radius:9999px;content:""}.after\:bg-white:after{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity));content:""}.after\:shadow-md:after{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow);content:""}.after\:duration-300:after{content:"";transition-duration:.3s}.visited\:border-red-900:visited{--tw-border-opacity:1;border-color:rgba(127,29,29,var(--tw-border-opacity))}.hover\:text-red-700:hover{--tw-text-opacity:1;color:rgba(185,28,28,var(--tw-text-opacity))}.hover\:text-red-600:hover{--tw-text-opacity:1;color:rgba(220,38,38,var(--tw-text-opacity))}.peer:checked~.peer-checked\:bg-red-600{--tw-bg-opacity:1;background-color:rgba(220,38,38,var(--tw-bg-opacity))}.peer:checked~.peer-checked\:after\:translate-x-2:after{--tw-translate-x:0.5rem;content:"";transform:var(--tw-transform)}.peer:checked~.peer-checked\:after\:bg-gray-900:after{content:""}.dark .dark\:bg-gray-900,.peer:checked~.peer-checked\:after\:bg-gray-900:after{--tw-bg-opacity:1;background-color:rgba(17,24,39,var(--tw-bg-opacity))}.dark .dark\:text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.dark .dark\:text-gray-100{--tw-text-opacity:1;color:rgba(243,244,246,var(--tw-text-opacity))}@media (min-width:768px){.md\:px-6{padding-left:1.5rem;padding-right:1.5rem}}ul.tag-list:before{content:attr(aria-label);font-weight:700;margin-right:.5rem}</style><meta name="generator" content="Gatsby 4.2.0"/><title data-react-helmet="true">Filoblog</title><meta data-react-helmet="true" name="description" content="My thoughts on development and other stuff."/><meta data-react-helmet="true" name="keywords" content="javascript, development, blog"/><link rel="icon" href="/favicon-32x32.png?v=83afc09155273e126311350cff13adb8" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#f4f4f4"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=83afc09155273e126311350cff13adb8"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=83afc09155273e126311350cff13adb8"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=83afc09155273e126311350cff13adb8"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=83afc09155273e126311350cff13adb8"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=83afc09155273e126311350cff13adb8"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=83afc09155273e126311350cff13adb8"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=83afc09155273e126311350cff13adb8"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=83afc09155273e126311350cff13adb8"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link as="script" rel="preload" href="/webpack-runtime-4476033667a0b29f1185.js"/><link as="script" rel="preload" href="/framework-70398fa0e7f56bcdc6ae.js"/><link as="script" rel="preload" href="/app-8b1c102b63faef506cff.js"/><link as="script" rel="preload" href="/1bfc9850-d3a1a7180d88f5a8aef5.js"/><link as="script" rel="preload" href="/7d7149ff3b97ecd484373da1d4e6049765309cd1-21fa3f28b34e103b9915.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-5ded1272020ff5bb07d9.js"/><link as="fetch" rel="preload" href="/page-data/theme-toggle-on-a-gatsby-mdx-site/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body class="bg-white text-gray-900 dark:bg-gray-900 dark:text-gray-100"><script>
  window.theme = {
    init: () => {
      window.theme.set(window.theme.current())
    },
    current: () => localStorage.getItem('theme:dark') === 'true',
    set: (to) => {
      document.documentElement.classList.toggle('dark', to);
      const result = document.documentElement.classList.contains('dark');
      localStorage.setItem('theme:dark', result);
      return result
    },
    toggle: () => window.theme.set(!window.theme.current())
  }

  window.theme.init();
  </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="mb-8"><div class="my-0 mx-auto max-w-2xl py-2 px-3 md:px-6 flex justify-between items-center flex-wrap"><h1 class="text-2xl font-semibold tracking-wide"><a class="uppercase hover:text-red-600 transition-colors duration-300 ease-in-out" href="/">Filoblog</a></h1><ul class="flex items-center m-0"><li><a href="https://twitter.com/cfiloteo12" rel="noopener noreferrer" target="_blank" class="p-2 inline-flex hover:text-red-600 transition-colors duration-300 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><span class="sr-only">Follow me as @cfiloteo12 on Twitter</span></a></li><li class="m-0"><a href="https://github.com/filoxo" rel="noopener noreferrer" target="_blank" class="p-2 inline-flex hover:text-red-600 transition-colors duration-300 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 480 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg><span class="sr-only">Checkout my Github profile (@filoxo)</span></a></li><li><a href="https://www.linkedin.com/in/carlosfiloteo/" rel="noopener noreferrer" target="_blank" class="p-2 inline-flex hover:text-red-600 transition-colors duration-300 ease-in-out"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><span class="sr-only">Let&#x27;s connect on LinkedIn</span></a></li><li><label class="relative flex justify-between items-center group"><input type="checkbox" class="absolute left-1/2 -translate-x-1/2 w-full h-full peer appearance-none rounded-sm" aria-label="Toggle site theme"/><span class="w-8 h-5 flex items-center flex-shrink-0 ml-8 p-1 bg-gray-900 rounded-full duration-300 ease-in-out peer-checked:bg-red-600 after:w-4 after:h-4 after:bg-white peer-checked:after:bg-gray-900 after:rounded-full after:shadow-md after:duration-300 peer-checked:after:translate-x-2"></span></label></li></ul></div></div><div class="my-0 mx-auto max-w-2xl px-3 md:px-6"><article class="mb-12"><h1 class="text-2xl mb-4 text-red-600">Theme toggle on a Gatsby + MDX site</h1><div class="text-red-600 mb-4">27 Nov 21</div><div class="space-y-6"><p>I recently read <a href="https://www.joshwcomeau.com/react/dark-mode/" class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out border-b	border-dashed border-current visited:border-red-900">Josh Comeau&#x27;s excellent article</a> on how he was able to achieve a theme toggle on his Gatsby site. I find his solution to be excellent! However my Gatsby site is, for better or worse, pretty tied to MDX and React. I implemented a solution based on his for my current site theme.</p><h2 class="text-2xl">Prereq: Update libraries</h2><p>Before I started this feature, I had to update my blog... and its about <strong>2 years behind</strong> üò¨. This meant Gatsby &amp; plugins needed two major version upgrades. While at it, I ditched CSS Modules for Tailwind and then refactored all the components to use these utility classes. With that out of the way...</p><h2 class="text-2xl">Step 1: Updating HTML in Gatsby</h2><p>Using the Gatsby SSR <code class="bg-gray-200 text-black rounded-sm px-1">setPreBodyComponents</code> technique Josh described, my implementation just had slightly different code to run on the client so for brevity that&#x27;s all I&#x27;ll include.</p><pre class="prism-code language-jsx px-3 py-2 rounded-lg overflow-auto" style="color:#ffffff;background-color:#1F2937"><div class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#F87171">const</span><span class="token plain"> codeToRunOnClient </span><span class="token operator" style="color:#F87171">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#DC2626">`</span><span class="token template-string string" style="color:#DC2626"></span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">  window.theme = {</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">    init: () =&gt; {</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">      window.theme.set(window.theme.current())</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">    },</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">    current: () =&gt; localStorage.getItem(&#x27;theme:dark&#x27;) === &#x27;true&#x27;,</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">    set: (to) =&gt; {</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">      document.documentElement.classList.toggle(&#x27;dark&#x27;, to);</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">      const result = document.documentElement.classList.contains(&#x27;dark&#x27;);</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">      localStorage.setItem(&#x27;theme:dark&#x27;, result);</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">      return result</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">    },</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">    toggle: () =&gt; window.theme.set(!window.theme.current())</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">  }    </span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="display:inline-block;color:#DC2626">
</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626">  window.theme.init();</span></div><div class="token-line" style="color:#ffffff"><span class="token template-string string" style="color:#DC2626"></span><span class="token template-string template-punctuation string" style="color:#DC2626">`</span></div></pre><p>My site doesn&#x27;t have a problem with globals since I control the libraries used on my blog. Maybe I&#x27;ll change this if it becomes a problem in the future.</p><p>I created following functions on a global <code class="bg-gray-200 text-black rounded-sm px-1">theme</code> object:</p><ul class="ml-4 list-inside list-disc"><li><code class="bg-gray-200 text-black rounded-sm px-1">init</code> runs on the client to initialize the theme (aka make sure the html element has the right className) before the rest of HTML is rendered</li><li><code class="bg-gray-200 text-black rounded-sm px-1">current</code> returns the current theme state, which is stored in localStorage</li><li><code class="bg-gray-200 text-black rounded-sm px-1">set</code> toggles the class to the HTML element that controls the theme, and updates the localStorage state based on whether that was successful, and returns the current state for React to store/sync</li><li><code class="bg-gray-200 text-black rounded-sm px-1">toggle</code> is basically just a wrapper around <code class="bg-gray-200 text-black rounded-sm px-1">set</code> that negates the <code class="bg-gray-200 text-black rounded-sm px-1">current</code> value, for convenience</li></ul><p>The <code class="bg-gray-200 text-black rounded-sm px-1">set</code> logic was useful because I was seeing behavior where the <code class="bg-gray-200 text-black rounded-sm px-1">classList.toggle</code> would actually fail to add the class for whatever reason. This approach ensured the state was always correct based on the dom.</p><h2 class="text-2xl">Step 2: Crossing the chasm</h2><p>The helper functions are setup before any of the rest of the page so once React kicks in I simply wire it up to the ThemeToggle component:</p><pre class="prism-code language-jsx px-3 py-2 rounded-lg overflow-auto" style="color:#ffffff;background-color:#1F2937"><div class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#F87171">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F87171">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F87171">function</span><span class="token plain"> </span><span class="token function" style="color:#DC2626">ThemeToggle</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#F87171">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">[</span><span class="token plain">darkModeEnabled</span><span class="token punctuation" style="color:#FECACA;font-style:italic">,</span><span class="token plain"> setDarkModeEnabled</span><span class="token punctuation" style="color:#FECACA;font-style:italic">]</span><span class="token plain"> </span><span class="token operator" style="color:#F87171">=</span><span class="token plain"> </span><span class="token function" style="color:#DC2626">useState</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"> </span><span class="token operator" style="color:#F87171">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    window</span><span class="token punctuation" style="color:#FECACA;font-style:italic">.</span><span class="token plain">theme</span><span class="token punctuation" style="color:#FECACA;font-style:italic">.</span><span class="token function" style="color:#DC2626">current</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#F87171">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:#DC2626">handleThemeToggle</span><span class="token plain"> </span><span class="token operator" style="color:#F87171">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"> </span><span class="token operator" style="color:#F87171">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token function" style="color:#DC2626">setDarkModeEnabled</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token plain">window</span><span class="token punctuation" style="color:#FECACA;font-style:italic">.</span><span class="token plain">theme</span><span class="token punctuation" style="color:#FECACA;font-style:italic">.</span><span class="token function" style="color:#DC2626">toggle</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#FECACA;font-style:italic">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#F87171">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#FECACA;font-style:italic">&lt;</span><span class="token tag" style="color:#DC2626">label</span><span class="token tag punctuation" style="color:#FECACA;font-style:italic">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token tag punctuation" style="color:#FECACA;font-style:italic">&lt;</span><span class="token tag" style="color:#DC2626">input</span><span class="token tag" style="color:#DC2626"></span></div><div class="token-line" style="color:#ffffff"><span class="token tag" style="color:#DC2626">        </span><span class="token tag attr-name" style="color:#DC2626">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#FECACA;font-style:italic">=</span><span class="token tag attr-value punctuation" style="color:#FECACA;font-style:italic">&quot;</span><span class="token tag attr-value" style="color:#DC2626">checkbox</span><span class="token tag attr-value punctuation" style="color:#FECACA;font-style:italic">&quot;</span><span class="token tag" style="color:#DC2626"></span></div><div class="token-line" style="color:#ffffff"><span class="token tag" style="color:#DC2626">        </span><span class="token tag attr-name" style="color:#DC2626">checked</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#FECACA;font-style:italic">=</span><span class="token tag script language-javascript punctuation" style="color:#FECACA;font-style:italic">{</span><span class="token tag script language-javascript" style="color:#DC2626">darkModeEnabled</span><span class="token tag script language-javascript punctuation" style="color:#FECACA;font-style:italic">}</span><span class="token tag" style="color:#DC2626"></span></div><div class="token-line" style="color:#ffffff"><span class="token tag" style="color:#DC2626">        </span><span class="token tag attr-name" style="color:#DC2626">onChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#FECACA;font-style:italic">=</span><span class="token tag script language-javascript punctuation" style="color:#FECACA;font-style:italic">{</span><span class="token tag script language-javascript" style="color:#DC2626">handleThemeToggle</span><span class="token tag script language-javascript punctuation" style="color:#FECACA;font-style:italic">}</span><span class="token tag" style="color:#DC2626"></span></div><div class="token-line" style="color:#ffffff"><span class="token tag" style="color:#DC2626">      </span><span class="token tag punctuation" style="color:#FECACA;font-style:italic">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token tag punctuation" style="color:#FECACA;font-style:italic">&lt;/</span><span class="token tag" style="color:#DC2626">label</span><span class="token tag punctuation" style="color:#FECACA;font-style:italic">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#FECACA;font-style:italic">}</span></div></pre><p>Some code was omitted just to highlight the relevant parts. When the component mounts it syncs the <code class="bg-gray-200 text-black rounded-sm px-1">theme.current()</code> state, and onChange it calls <code class="bg-gray-200 text-black rounded-sm px-1">theme.toggle()</code> and updates local state.</p><h3 class="text-xl">SSR</h3><p>Gatsby won&#x27;t let you forget about SSR! <code class="bg-gray-200 text-black rounded-sm px-1">window</code> is not defined when server-side rendering so we have to handle it by checking if we&#x27;re in a browser environment and short circuiting if true.</p><pre class="prism-code language-jsx px-3 py-2 rounded-lg overflow-auto" style="color:#ffffff;background-color:#1F2937"><div class="token-line" style="color:#ffffff"><span class="token comment" style="color:#FECACA;font-style:italic">// Check if in browser environment</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#F87171">const</span><span class="token plain"> isBrowser </span><span class="token operator" style="color:#F87171">=</span><span class="token plain"> </span><span class="token keyword" style="color:#F87171">typeof</span><span class="token plain"> window </span><span class="token operator" style="color:#F87171">!==</span><span class="token plain"> </span><span class="token string" style="color:#DC2626">&#x27;undefined&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#F87171">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F87171">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F87171">function</span><span class="token plain"> </span><span class="token function" style="color:#DC2626">ThemeToggle</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#F87171">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">[</span><span class="token plain">darkModeEnabled</span><span class="token punctuation" style="color:#FECACA;font-style:italic">,</span><span class="token plain"> setDarkModeEnabled</span><span class="token punctuation" style="color:#FECACA;font-style:italic">]</span><span class="token plain"> </span><span class="token operator" style="color:#F87171">=</span><span class="token plain"> </span><span class="token function" style="color:#DC2626">useState</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"> </span><span class="token operator" style="color:#F87171">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#FECACA;font-style:italic">// Short circuit if not in browser</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#F87171">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token operator" style="color:#F87171">!</span><span class="token plain">isBrowser</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"> </span><span class="token keyword" style="color:#F87171">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#F87171">else</span><span class="token plain"> </span><span class="token keyword" style="color:#F87171">return</span><span class="token plain"> window</span><span class="token punctuation" style="color:#FECACA;font-style:italic">.</span><span class="token plain">theme</span><span class="token punctuation" style="color:#FECACA;font-style:italic">.</span><span class="token function" style="color:#DC2626">current</span><span class="token punctuation" style="color:#FECACA;font-style:italic">(</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token punctuation" style="color:#FECACA;font-style:italic">}</span><span class="token punctuation" style="color:#FECACA;font-style:italic">)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token comment" style="color:#FECACA;font-style:italic">// ... rest of code</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#FECACA;font-style:italic">}</span></div></pre><p>The rest of the code doesn&#x27;t get executed on the server so it doesn&#x27;t need updating.</p><h3 class="text-xl">Step 3: Adding a toggle</h3><p>Last step is to build the markup for the theme toggle. I found this great <a href="https://medium.com/front-end-weekly/build-a-css-only-toggle-switch-using-tailwindcss-d2739882934" class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out border-b	border-dashed border-current visited:border-red-900">Build a CSS only toggle switch using TailwindCSS</a> article that was very well executed, built with accessibility and semantics in mind. I just copy-and-pasted the code and modified the colors and sizing.</p><p>That&#x27;s it! I&#x27;m pretty happy with my site redesign, and this ThemeToggle was a huge bonus!</p><footer class="space-y-12"><span class="inline-flex flex-wrap"><ul aria-label="Tags:" class="tag-list inline-flex flex-wrap m-0 space-x-2"><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/javascript">javascript</a>, </li><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/react">react</a>, </li><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/gatsby">gatsby</a>, </li><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/mdx">mdx</a>, </li><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/other1">other1</a>, </li><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/other2">other2</a>, </li><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/other3">other3</a>, </li><li><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/tags/other4">other4</a></li></ul></span><div class="flex flex-row-reverse justify-between"><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/">‚Üê Back to home</a><a class="text-red-600 hover:text-red-700 no-underline transition-colors duration-300 ease-in-out" href="/theme-toggle-on-a-gatsby-mdx-site/#">Jump to top¬†‚Üë</a></div></footer></div></article></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  function gaOptout(){document.cookie=disableStr+'=true; expires=Thu, 31 Dec 2099 23:59:59 UTC;path=/',window[disableStr]=!0}var gaProperty='UA-74758179-2',disableStr='ga-disable-'+gaProperty;document.cookie.indexOf(disableStr+'=true')>-1&&(window[disableStr]=!0);
  if(!(parseInt(navigator.doNotTrack) === 1 || parseInt(window.doNotTrack) === 1 || parseInt(navigator.msDoNotTrack) === 1 || navigator.doNotTrack === "yes")) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-74758179-2', 'auto', {});
      ga('set', 'anonymizeIp', true);
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/theme-toggle-on-a-gatsby-mdx-site/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-f9e51143ced7741c9599.js"],"app":["/app-8b1c102b63faef506cff.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-aaee919be46927f364d2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-e9089d05eaa54811d7e8.js"],"component---src-pages-index-js":["/component---src-pages-index-js-4b22083e37e1833a15d2.js"],"component---src-templates-post-js":["/component---src-templates-post-js-5ded1272020ff5bb07d9.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-649bd52b795464e7e42a.js"]};/*]]>*/</script><script src="/polyfill-f9e51143ced7741c9599.js" nomodule=""></script><script src="/component---src-templates-post-js-5ded1272020ff5bb07d9.js" async=""></script><script src="/7d7149ff3b97ecd484373da1d4e6049765309cd1-21fa3f28b34e103b9915.js" async=""></script><script src="/1bfc9850-d3a1a7180d88f5a8aef5.js" async=""></script><script src="/app-8b1c102b63faef506cff.js" async=""></script><script src="/framework-70398fa0e7f56bcdc6ae.js" async=""></script><script src="/webpack-runtime-4476033667a0b29f1185.js" async=""></script></body></html>