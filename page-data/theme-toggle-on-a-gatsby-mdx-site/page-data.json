{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/theme-toggle-on-a-gatsby-mdx-site/",
    "result": {"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Theme toggle on a Gatsby + MDX site\",\n  \"date\": \"2021-11-27T00:00:00.000Z\",\n  \"tags\": [\"javascript\", \"react\", \"gatsby\", \"mdx\", \"other1\", \"other2\", \"other3\", \"other4\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"I recently read \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.joshwcomeau.com/react/dark-mode/\"\n  }, \"Josh Comeau's excellent article\"), \" on how he was able to achieve a theme toggle on his Gatsby site. I find his solution to be excellent! However my Gatsby site is, for better or worse, pretty tied to MDX and React. I implemented a solution based on his for my current site theme.\"), mdx(\"h2\", null, \"Prereq: Update libraries\"), mdx(\"p\", null, \"Before I started this feature, I had to update my blog... and its about \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"2 years behind\"), \" \\uD83D\\uDE2C. This meant Gatsby & plugins needed two major version upgrades. While at it, I ditched CSS Modules for Tailwind and then refactored all the components to use these utility classes. With that out of the way...\"), mdx(\"h2\", null, \"Step 1: Updating HTML in Gatsby\"), mdx(\"p\", null, \"Using the Gatsby SSR \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"setPreBodyComponents\"), \" technique Josh described, my implementation just had slightly different code to run on the client so for brevity that's all I'll include.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"const codeToRunOnClient = `\\n  window.theme = {\\n    init: () => {\\n      window.theme.set(window.theme.current())\\n    },\\n    current: () => localStorage.getItem('theme:dark') === 'true',\\n    set: (to) => {\\n      document.documentElement.classList.toggle('dark', to);\\n      const result = document.documentElement.classList.contains('dark');\\n      localStorage.setItem('theme:dark', result);\\n      return result\\n    },\\n    toggle: () => window.theme.set(!window.theme.current())\\n  }    \\n\\n  window.theme.init();\\n`\\n\")), mdx(\"p\", null, \"My site doesn't have a problem with globals since I control the libraries used on my blog. Maybe I'll change this if it becomes a problem in the future.\"), mdx(\"p\", null, \"I created following functions on a global \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"theme\"), \" object:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"init\"), \" runs on the client to initialize the theme (aka make sure the html element has the right className) before the rest of HTML is rendered\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"current\"), \" returns the current theme state, which is stored in localStorage\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"set\"), \" toggles the class to the HTML element that controls the theme, and updates the localStorage state based on whether that was successful, and returns the current state for React to store/sync\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"toggle\"), \" is basically just a wrapper around \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"set\"), \" that negates the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"current\"), \" value, for convenience\")), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"set\"), \" logic was useful because I was seeing behavior where the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"classList.toggle\"), \" would actually fail to add the class for whatever reason. This approach ensured the state was always correct based on the dom.\"), mdx(\"h2\", null, \"Step 2: Crossing the chasm\"), mdx(\"p\", null, \"The helper functions are setup before any of the rest of the page so once React kicks in I simply wire it up to the ThemeToggle component:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"export default function ThemeToggle() {\\n  const [darkModeEnabled, setDarkModeEnabled] = useState(() =>\\n    window.theme.current()\\n  )\\n\\n  let handleThemeToggle = () => {\\n    setDarkModeEnabled(window.theme.toggle())\\n  }\\n\\n  return (\\n    <label>\\n      <input\\n        type=\\\"checkbox\\\"\\n        checked={darkModeEnabled}\\n        onChange={handleThemeToggle}\\n      />\\n    </label>\\n  )\\n}\\n\")), mdx(\"p\", null, \"Some code was omitted just to highlight the relevant parts. When the component mounts it syncs the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"theme.current()\"), \" state, and onChange it calls \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"theme.toggle()\"), \" and updates local state.\"), mdx(\"h3\", null, \"SSR\"), mdx(\"p\", null, \"Gatsby won't let you forget about SSR! \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"window\"), \" is not defined when server-side rendering so we have to handle it by checking if we're in a browser environment and short circuiting if true.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx\"\n  }, \"// Check if in browser environment\\nconst isBrowser = typeof window !== 'undefined'\\n\\nexport default function ThemeToggle() {\\n  const [darkModeEnabled, setDarkModeEnabled] = useState(() => {\\n    // Short circuit if not in browser\\n    if (!isBrowser) return false\\n    else return window.theme.current()\\n  })\\n  // ... rest of code\\n}\\n\")), mdx(\"p\", null, \"The rest of the code doesn't get executed on the server so it doesn't need updating.\"), mdx(\"h3\", null, \"Step 3: Adding a toggle\"), mdx(\"p\", null, \"Last step is to build the markup for the theme toggle. I found this great \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://medium.com/front-end-weekly/build-a-css-only-toggle-switch-using-tailwindcss-d2739882934\"\n  }, \"Build a CSS only toggle switch using TailwindCSS\"), \" article that was very well executed, built with accessibility and semantics in mind. I just copy-and-pasted the code and modified the colors and sizing.\"), mdx(\"p\", null, \"That's it! I'm pretty happy with my site redesign, and this ThemeToggle was a huge bonus!\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Theme toggle on a Gatsby + MDX site","date":"27 Nov 21","tags":["javascript","react","gatsby","mdx","other1","other2","other3","other4"]}}},"pageContext":{"slug":"/theme-toggle-on-a-gatsby-mdx-site/"}},
    "staticQueryHashes": ["3649515864"]}